<!doctype html><html class=position-relative itemscope itemtype=http://schema.org/WebPage lang=zh-cn data-theme=auto data-bs-theme=auto data-palette=blue-gray><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Java语言使用注解处理器生成代码——第三部分：生成源代码 - 琴弦第七</title><link rel=icon href=https://www.qinxiandiqi.sbs/favicon_huc1d2ba7c7d6d5aa3e01f2f328b911c53_11507_16x16_resize_box_3.png sizes=16x16 type=image/png><link rel=icon href=https://www.qinxiandiqi.sbs/favicon_huc1d2ba7c7d6d5aa3e01f2f328b911c53_11507_32x32_resize_box_3.png sizes=32x32 type=image/png><link rel=apple-touch-icon href=https://www.qinxiandiqi.sbs/favicon_huc1d2ba7c7d6d5aa3e01f2f328b911c53_11507_180x180_resize_box_3.png sizes=180x180 type=image/png><link rel=icon href=https://www.qinxiandiqi.sbs/favicon_huc1d2ba7c7d6d5aa3e01f2f328b911c53_11507_150x150_resize_box_3.png sizes=150x150 type=image/png><link rel=icon href=https://www.qinxiandiqi.sbs/favicon_huc1d2ba7c7d6d5aa3e01f2f328b911c53_11507_192x192_resize_box_3.png sizes=192x192 type=image/png><link rel=mask-icon href=https://www.qinxiandiqi.sbs/safari-pinned-tab.svg color=#6f42c1><link rel=icon href="https://www.qinxiandiqi.sbs/images/icons/favicon.ico?version=2a4098caa2eb82a1f873269b3ff57965"><meta name=keywords content><meta name=description content="本文是我的“使用Java语言注解处理器生成代码”系列第三部分，也是最后一部分。在第一部分中（请阅读这里），我们介绍了什么是Java语言的注解，以及一些常用的方法。在第二部分中（请阅读这里），我们介绍了注解处理器，以及注解处理器如何创建和运行。
现在，在第三部分中，我们要学习如何使用注解处理器来生成源代码。"><meta name=robots content="index, follow"><meta name=twitter:card content="summary"><meta name=twitter:title content="Java语言使用注解处理器生成代码——第三部分：生成源代码"><meta name=twitter:description content="本文是我的“使用Java语言注解处理器生成代码”系列第三部分，也是最后一部分。在第一部分中（请阅读这里），我们介绍了什么是Java语言的注解，以及一些常用的方法。在第二部分中（请阅读这里），我们介绍了注解处理器，以及注解处理器如何创建和运行。
现在，在第三部分中，我们要学习如何使用注解处理器来生成源代码。"><meta name=twitter:site content="@qinxiandiqi"><meta property="og:title" content="Java语言使用注解处理器生成代码——第三部分：生成源代码"><meta property="og:description" content="本文是我的“使用Java语言注解处理器生成代码”系列第三部分，也是最后一部分。在第一部分中（请阅读这里），我们介绍了什么是Java语言的注解，以及一些常用的方法。在第二部分中（请阅读这里），我们介绍了注解处理器，以及注解处理器如何创建和运行。
现在，在第三部分中，我们要学习如何使用注解处理器来生成源代码。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.qinxiandiqi.sbs/posts/java/java%E8%AF%AD%E8%A8%80%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81/java%E8%AF%AD%E8%A8%80%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%E7%94%9F%E6%88%90%E6%BA%90%E4%BB%A3%E7%A0%81/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-10-24T19:50:39+08:00"><meta property="article:modified_time" content="2015-10-24T19:50:39+08:00"><meta property="og:see_also" content="https://www.qinxiandiqi.sbs/posts/java/transient%E4%BF%AE%E9%A5%B0%E5%AF%B9%E8%B1%A1%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%BAnull/"><meta property="og:see_also" content="https://www.qinxiandiqi.sbs/posts/java/java%E8%AF%AD%E8%A8%80%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81/java%E8%AF%AD%E8%A8%80%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8/"><meta property="og:see_also" content="https://www.qinxiandiqi.sbs/posts/java/java%E8%AF%AD%E8%A8%80%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81/java%E8%AF%AD%E8%A8%80%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%E6%B3%A8%E8%A7%A3%E7%B1%BB%E5%9E%8B/"><meta itemprop=name content="Java语言使用注解处理器生成代码——第三部分：生成源代码"><meta itemprop=description content="本文是我的“使用Java语言注解处理器生成代码”系列第三部分，也是最后一部分。在第一部分中（请阅读这里），我们介绍了什么是Java语言的注解，以及一些常用的方法。在第二部分中（请阅读这里），我们介绍了注解处理器，以及注解处理器如何创建和运行。
现在，在第三部分中，我们要学习如何使用注解处理器来生成源代码。"><meta itemprop=datePublished content="2015-10-24T19:50:39+08:00"><meta itemprop=dateModified content="2015-10-24T19:50:39+08:00"><meta itemprop=wordCount content="4349"><meta itemprop=keywords content="java,注解处理器,源代码,自动生成,"><meta property="og:image" content="https://www.qinxiandiqi.sbs/images/logo.png"><meta name=twitter:image content="https://www.qinxiandiqi.sbs/images/logo.png"><link rel=manifest href=https://www.qinxiandiqi.sbs/manifest.json><link data-precache rel=stylesheet href="https://www.qinxiandiqi.sbs/assets/main/bundle.min.4d0a628e427af2df862b411feced006985e5e7f4abf1d52b690dcf44facac475.css" integrity="sha256-TQpijkJ68t+GK0Ef7O0AaYXl5/Sr8dUraQ3PRPrKxHU=" crossorigin=anonymous><link data-precache rel=stylesheet href=https://www.qinxiandiqi.sbs/assets/viewer/bundle.min.6d0fc65b8b058ac563091dc5c36f61afba5dd705058680aa24f1d5a3bcf0064d.css integrity="sha256-bQ/GW4sFisVjCR3Fw29hr7pd1wUFhoCqJPHVo7zwBk0=" crossorigin=anonymous></head><body><script>const items=["theme","palette"];items.forEach(function(e){const t=localStorage.getItem("hbs:"+e);t&&document.body.parentElement.setAttribute("data-"+e,t)})</script><header><nav class="top-app-bar shadow navbar navbar-expand-lg fixed-top"><div class=container><a class="navbar-brand d-flex align-items-center flex-grow-1 flex-lg-grow-0 text-lg-start ms-2 ms-lg-0 mx-auto me-lg-2" href=https://www.qinxiandiqi.sbs/><picture><img class=logo alt=Logo src=https://www.qinxiandiqi.sbs/images/logo.png loading=lazy width=500 height=500>
</picture>琴弦第七</a>
<button class="navbar-toggler order-5" type=button data-bs-toggle=offcanvas data-bs-target=#navbarMenus aria-controls=navbarMenus aria-expanded=false aria-label="Toggle navigation">
<i class="fas fa-ellipsis-h"></i></button><div class="offcanvas-lg offcanvas-end flex-grow-1" data-bs-scroll=true tabindex=-1 id=navbarMenus aria-labelledby=navbarMenusLabel><div class="offcanvas-header px-4 pb-0"><h5 class=offcanvas-title id=navbarMenusLabel>琴弦第七</h5><button type=button class="btn-close btn-close-white" data-bs-dismiss=offcanvas data-bs-target=#navbarMenus aria-label=Close></button></div><div class="offcanvas-body p-4 pt-0 p-lg-0"><hr class=d-lg-none><ul class="navbar-nav flex-row flex-wrap align-items-center me-auto"><li class="nav-item col-6 col-lg-auto"><a class="nav-link py-2 px-0 px-lg-2" href=https://www.qinxiandiqi.sbs/archives/><i class="fas fa-fw fa-file-archive"></i>归档</a></li><li class="nav-item col-6 col-lg-auto"><a class="nav-link py-2 px-0 px-lg-2" href=https://www.qinxiandiqi.sbs/series/><i class="fas fa-fw fa-columns"></i>专栏</a></li><li class="nav-item col-6 col-lg-auto"><a class="nav-link py-2 px-0 px-lg-2" href=https://www.qinxiandiqi.sbs/categories/><i class="fas fa-fw fa-folder"></i>分类</a></li><li class="nav-item col-6 col-lg-auto"><a class="nav-link py-2 px-0 px-lg-2" href=https://www.qinxiandiqi.sbs/tags/><i class="fas fa-fw fa-tags"></i>标签</a></li></ul><hr class=d-lg-none><form class="search-bar ms-auto my-1" action=https://www.qinxiandiqi.sbs/search/ novalidate><div class="input-group input-group-sm align-items-center"><span class="btn btn-search disabled position-absolute left-0 border-0"><i class="fas fa-fw fa-search fa-lg"></i></span>
<input class="py-2 form-control rounded search-input" name=q type=search aria-label=Search required></div></form><hr class=d-lg-none><ul class="navbar-nav flex-row flex-wrap align-items-center ms-md-auto"><li class="nav-item py-2 py-lg-1 col-12 col-lg-auto"><nav class="social-links nav justify-content-center flex-row"><a class="nav-link social-link col-6 col-lg-auto p-1" target=_blank href=https://github.com/qinxiandiqi title=GitHub rel="noopener noreferrer"><i class="fa-fw fab fa-github"></i>
<span class="ms-1 d-lg-none">GitHub</span></a>
<a class="nav-link social-link col-6 col-lg-auto p-1" target=_blank href=https://www.qinxiandiqi.sbs/index.xml title=RSS rel="noopener noreferrer"><i class="fas fa-fw fa-rss"></i>
<span class="ms-1 d-lg-none">RSS</span></a></nav></li><li class="nav-item py-2 py-lg-1 col-12 col-lg-auto"><div class="vr d-none d-lg-flex h-100 mx-lg-2 text-white"></div><hr class="d-lg-none my-2"></li><li class="nav-item dropdown py-1 py-lg-1 col-6 col-lg-auto"><a class="nav-link px-0 px-lg-1" href=# id=languageDropdown role=button data-bs-toggle=dropdown aria-expanded=false><i class="fas fa-fw fa-globe"></i>
<span class=d-lg-none>语言</span></a><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=languageDropdown><li><a class="dropdown-item active" href=https://www.qinxiandiqi.sbs/>简体中文</a></li><li><a class=dropdown-item href=https://www.qinxiandiqi.sbs/en/>English</a></li></ul></li><li class="nav-item py-1 col-12 col-lg-auto"><div class="vr d-none d-lg-flex h-100 mx-lg-2 text-white"></div><hr class="d-lg-none my-2"></li><li class="nav-item dropdown col-6 col-lg-auto"><a class="nav-link px-0 py-2 px-lg-1" href=# id=fontSizeDropdown role=button data-bs-toggle=dropdown aria-expanded=false><i class="fas fa-fw fa-font"></i>
<span class=d-lg-none>字体大小</span></a><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=fontSizeDropdown><li><button class="font-size-item dropdown-item" data-size=xs>
特小号</button></li><li><button class="font-size-item dropdown-item" data-size=sm>
小号</button></li><li><button class="font-size-item dropdown-item active" data-size=md>
中等</button></li><li><button class="font-size-item dropdown-item" data-size=lg>
大号</button></li><li><button class="font-size-item dropdown-item" data-size=xl>
特大号</button></li></ul></li><li class="nav-item dropdown col-6 col-lg-auto"><a class="nav-link px-0 py-2 px-lg-1" href=# id=paletteDropdown role=button data-bs-toggle=dropdown aria-expanded=false><i class="fas fa-fw fa-palette"></i>
<span class=d-lg-none>配色</span></a><ul class="dropdown-menu dropdown-menu-end px-2" aria-labelledby=paletteDropdown><div class=row><li class="col-4 my-1"><a role=button id=palette-blue aria-label=蓝色 class="btn btn-sm w-100 palette text-bg-blue" data-palette=blue></a></li><li class="col-4 my-1"><a role=button id=palette-blue-gray aria-label=蓝灰色 class="btn btn-sm w-100 palette text-bg-blue-gray" data-palette=blue-gray></a></li><li class="col-4 my-1"><a role=button id=palette-brown aria-label=棕色 class="btn btn-sm w-100 palette text-bg-brown" data-palette=brown></a></li><li class="col-4 my-1"><a role=button id=palette-cyan aria-label=青色 class="btn btn-sm w-100 palette text-bg-cyan" data-palette=cyan></a></li><li class="col-4 my-1"><a role=button id=palette-green aria-label=绿色 class="btn btn-sm w-100 palette text-bg-green" data-palette=green></a></li><li class="col-4 my-1"><a role=button id=palette-indigo aria-label=靛青色 class="btn btn-sm w-100 palette text-bg-indigo" data-palette=indigo></a></li><li class="col-4 my-1"><a role=button id=palette-orange aria-label=橙色 class="btn btn-sm w-100 palette text-bg-orange" data-palette=orange></a></li><li class="col-4 my-1"><a role=button id=palette-pink aria-label=粉色 class="btn btn-sm w-100 palette text-bg-pink" data-palette=pink></a></li><li class="col-4 my-1"><a role=button id=palette-purple aria-label=紫色 class="btn btn-sm w-100 palette text-bg-purple" data-palette=purple></a></li><li class="col-4 my-1"><a role=button id=palette-red aria-label=红色 class="btn btn-sm w-100 palette text-bg-red" data-palette=red></a></li><li class="col-4 my-1"><a role=button id=palette-teal aria-label=蓝绿色 class="btn btn-sm w-100 palette text-bg-teal" data-palette=teal></a></li><li class="col-4 my-1"><a role=button id=palette-yellow aria-label=黄色 class="btn btn-sm w-100 palette text-bg-yellow" data-palette=yellow></a></li></div></ul></li><li class="nav-item dropdown col-6 col-lg-auto"><a class="nav-link px-0 py-2 px-lg-1" href=# id=modeDropdown role=button data-bs-toggle=dropdown aria-expanded=false><i class="mode-icon fas fa-fw fa-adjust" id=modeIcon></i>
<span class=d-lg-none>模式</span></a><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=modeDropdown><li class=mode-item data-color-mode=light data-icon=sun><button class=dropdown-item>
<i class="mode-icon fas fa-fw fa-sun"></i> Light</button></li><li class=mode-item data-color-mode=dark data-icon=moon><button class=dropdown-item>
<i class="mode-icon fas fa-fw fa-moon"></i> Dark</button></li><li class="mode-item active" data-color-mode=auto data-icon=adjust><button class=dropdown-item>
<i class="mode-icon fas fa-fw fa-adjust"></i> Auto</button></li></ul></li></ul></div></div></div></nav></header><main class=container><div class="row content"><noscript><div class="alert alert-danger" role=alert>你的浏览器不支持 JavaScript。</div></noscript><aside class="col-lg-4 sidebar d-flex order-lg-5"><div class="container d-flex flex-column"><div class="accordion profile"><div class="accordion-item card row text-center component"><div class="accordion-header card-header border-0" id=profile-header><a class="accordion-button d-lg-none mb-2 collapsed shadow-none p-0 bg-transparent text-surface" type=button data-bs-toggle=collapse data-bs-target=#profile aria-expanded=false aria-controls=profile>Profile</a></div><div class="card-body collapse accordion-collapse accordion-body d-lg-block" id=profile aria-labelledby=profile-header><div class="col-12 d-flex align-items-center justify-content-center"><picture><img class="profile-avatar rounded-circle" alt=Jianan src=https://www.qinxiandiqi.sbs/images/profile.png loading=lazy data-viewer-invisible width=500 height=500></picture></div><div class="col-12 profile-meta"><div class="profile-name fw-fold fs-lg">Jianan</div><div class=profile-bio>今天做点什么呢？</div><div class="profile-about text-primary"><i class="fas fa-fw fa-user"></i><a href=https://www.qinxiandiqi.sbs/about/>关于我</a></div><div class="profile-contact text-primary"><i class="fas fa-fw fa-question-circle"></i><a href=https://www.qinxiandiqi.sbs/contact/>联系我</a></div></div><nav class="social-links nav justify-content-center mt-1 justify-content-around"><a class="nav-link social-link" href=mailto:qinxiandiqi@foxmail.com title=Email><i class="fas fa-fw fa-2x fa-envelope"></i></a>
<a class="nav-link social-link" target=_blank href=https://github.com/qinxiandiqi title=GitHub rel="noopener noreferrer"><i class="fa-fw fa-2x fab fa-github"></i></a>
<a class="nav-link social-link" target=_blank href=https://twitter.com/qinxiandiqi title=Twitter rel="noopener noreferrer"><i class="fa-fw fa-2x fab fa-twitter"></i></a>
<a class="nav-link social-link" target=_blank href=https://weibo.com/qinxiandiqi title=Weibo rel="noopener noreferrer"><i class="fa-fw fa-2x fab fa-weibo"></i></a>
<a class="nav-link social-link" target=_blank href=https://www.zhihu.com/people/qinxiandiqi title=Zhihu rel="noopener noreferrer"><i class="fa-fw fa-2x fab fa-zhihu"></i></a></nav></div></div></div><div class="accordion taxonomies-toggle"><section class="row card component accordion-item"><div class="accordion-header card-header border-0"><a class="accordion-button d-lg-none mb-1 collapsed shadow-none p-0 bg-transparent" type=button data-bs-toggle=collapse data-bs-target=#taxonomies-toggle aria-expanded=false aria-controls=taxonomies-toggle>Taxonomies</a></div><div class="card-body collapse accordion-collapse accordion-body d-lg-block" id=taxonomies-toggle><ul class="nav nav-pills nav-fill" id=myTab role=tablist><li class=nav-item role=presentation><button class="nav-link active" id=taxonomySeriesTab data-bs-toggle=tab data-bs-target=#taxonomySeries type=button role=tab aria-controls=专栏 aria-selected=true>
专栏</button></li><li class=nav-item role=presentation><button class=nav-link id=taxonomyCategoriesTab data-bs-toggle=tab data-bs-target=#taxonomyCategories type=button role=tab aria-controls=分类 aria-selected=true>
分类</button></li><li class=nav-item role=presentation><button class=nav-link id=taxonomyTagsTab data-bs-toggle=tab data-bs-target=#taxonomyTags type=button role=tab aria-controls=标签 aria-selected=true>
标签</button></li><li class=nav-item role=presentation><button class=nav-link id=taxonomyAuthorsTab data-bs-toggle=tab data-bs-target=#taxonomyAuthors type=button role=tab aria-controls=作者 aria-selected=true>
作者</button></li><li class=nav-item role=presentation><button class=nav-link id=taxonomyArchivesTab data-bs-toggle=tab data-bs-target=#taxonomyArchive type=button role=tab aria-controls=taxonomyArchives aria-selected=true>
归档</button></li></ul><div class="tab-content mt-3"><div class="tab-pane active" id=taxonomySeries role=tabpanel aria-labelledby=taxonomySeriesTab tabindex=0><a href=https://www.qinxiandiqi.sbs/series/raspberry/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title=RaspBerry>RaspBerry
<span class="badge badge-sm text-secondary bg-white ms-1">27</span></a>
<a href=https://www.qinxiandiqi.sbs/series/android/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title=Android>Android
<span class="badge badge-sm text-secondary bg-white ms-1">24</span></a>
<a href=https://www.qinxiandiqi.sbs/series/java%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title=Java学习笔记>Java学习笔记
<span class="badge badge-sm text-secondary bg-white ms-1">17</span></a>
<a href=https://www.qinxiandiqi.sbs/series/javaweb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title=JavaWeb学习笔记>JavaWeb学习笔记
<span class="badge badge-sm text-secondary bg-white ms-1">12</span></a>
<a href=https://www.qinxiandiqi.sbs/series/android-wear/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Android Wear">Android Wear
<span class="badge badge-sm text-secondary bg-white ms-1">11</span></a>
<a href=https://www.qinxiandiqi.sbs/series/libgdx/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title=libGDX>libGDX
<span class="badge badge-sm text-secondary bg-white ms-1">8</span></a>
<a href=https://www.qinxiandiqi.sbs/series/libgdx%E6%89%8B%E5%86%8C/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title=libGDX手册>libGDX手册
<span class="badge badge-sm text-secondary bg-white ms-1">7</span></a>
<a href=https://www.qinxiandiqi.sbs/series/android-gradle/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Android Gradle">Android Gradle
<span class="badge badge-sm text-secondary bg-white ms-1">6</span></a>
<a href=https://www.qinxiandiqi.sbs/series/javascript%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title=JavaScript学习笔记>JavaScript学习笔记
<span class="badge badge-sm text-secondary bg-white ms-1">6</span></a>
<a href=https://www.qinxiandiqi.sbs/series/ide/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title=IDE>IDE
<span class="badge badge-sm text-secondary bg-white ms-1">5</span></a>
<a href=https://www.qinxiandiqi.sbs/series class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title=全部>全部
<span class="badge badge-sm text-secondary bg-white ms-1">27</span></a></div><div class=tab-pane id=taxonomyCategories role=tabpanel aria-labelledby=taxonomyCategoriesTab tabindex=0><a href=https://www.qinxiandiqi.sbs/categories/%E7%BF%BB%E8%AF%91/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title=翻译>翻译
<span class="badge badge-sm text-secondary bg-white ms-1">67</span></a>
<a href=https://www.qinxiandiqi.sbs/categories/raspberry/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title=RaspBerry>RaspBerry
<span class="badge badge-sm text-secondary bg-white ms-1">27</span></a>
<a href=https://www.qinxiandiqi.sbs/categories/android/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title=Android>Android
<span class="badge badge-sm text-secondary bg-white ms-1">24</span></a>
<a href=https://www.qinxiandiqi.sbs/categories/javaweb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title=JavaWeb学习笔记>JavaWeb学习笔记
<span class="badge badge-sm text-secondary bg-white ms-1">12</span></a>
<a href=https://www.qinxiandiqi.sbs/categories/android-wear/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="Android Wear">Android Wear
<span class="badge badge-sm text-secondary bg-white ms-1">11</span></a>
<a href=https://www.qinxiandiqi.sbs/categories/libgdx/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title=libGDX>libGDX
<span class="badge badge-sm text-secondary bg-white ms-1">8</span></a>
<a href=https://www.qinxiandiqi.sbs/categories/libgdx%E6%89%8B%E5%86%8C/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title=libGDX手册>libGDX手册
<span class="badge badge-sm text-secondary bg-white ms-1">7</span></a>
<a href=https://www.qinxiandiqi.sbs/categories/android-gradle/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="Android Gradle">Android Gradle
<span class="badge badge-sm text-secondary bg-white ms-1">6</span></a>
<a href=https://www.qinxiandiqi.sbs/categories/javascript%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title=JavaScript学习笔记>JavaScript学习笔记
<span class="badge badge-sm text-secondary bg-white ms-1">6</span></a>
<a href=https://www.qinxiandiqi.sbs/categories/ide/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title=IDE>IDE
<span class="badge badge-sm text-secondary bg-white ms-1">5</span></a>
<a href=https://www.qinxiandiqi.sbs/categories class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title=全部>全部
<span class="badge badge-sm text-secondary bg-white ms-1">28</span></a></div><div class=tab-pane id=taxonomyTags role=tabpanel aria-labelledby=taxonomyTagsTab tabindex=0><a href=https://www.qinxiandiqi.sbs/tags/android/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=Android>Android
<span class="badge badge-sm text-secondary bg-white ms-1">33</span></a>
<a href=https://www.qinxiandiqi.sbs/tags/java/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=java>java
<span class="badge badge-sm text-secondary bg-white ms-1">31</span></a>
<a href=https://www.qinxiandiqi.sbs/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=树莓派>树莓派
<span class="badge badge-sm text-secondary bg-white ms-1">28</span></a>
<a href=https://www.qinxiandiqi.sbs/tags/raspberry/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=RaspBerry>RaspBerry
<span class="badge badge-sm text-secondary bg-white ms-1">27</span></a>
<a href=https://www.qinxiandiqi.sbs/tags/android-wear/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Android Wear">Android Wear
<span class="badge badge-sm text-secondary bg-white ms-1">11</span></a>
<a href=https://www.qinxiandiqi.sbs/tags/javaweb/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=javaweb>javaweb
<span class="badge badge-sm text-secondary bg-white ms-1">11</span></a>
<a href=https://www.qinxiandiqi.sbs/tags/%E5%8F%AF%E7%A9%BF%E6%88%B4%E8%AE%BE%E5%A4%87/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=可穿戴设备>可穿戴设备
<span class="badge badge-sm text-secondary bg-white ms-1">9</span></a>
<a href=https://www.qinxiandiqi.sbs/tags/libgdx/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=libgdx>libgdx
<span class="badge badge-sm text-secondary bg-white ms-1">8</span></a>
<a href=https://www.qinxiandiqi.sbs/tags/javascript/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=javascript>javascript
<span class="badge badge-sm text-secondary bg-white ms-1">7</span></a>
<a href=https://www.qinxiandiqi.sbs/tags/xml/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=xml>xml
<span class="badge badge-sm text-secondary bg-white ms-1">7</span></a>
<a href=https://www.qinxiandiqi.sbs/tags class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=全部>全部
<span class="badge badge-sm text-secondary bg-white ms-1">311</span></a></div><div class=tab-pane id=taxonomyAuthors role=tabpanel aria-labelledby=taxonomyAuthorsTab tabindex=0><a href=https://www.qinxiandiqi.sbs/authors/jianan/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-author me-2 mb-2" title=Jianan>Jianan
<span class="badge badge-sm text-secondary bg-white ms-1">148</span></a></div><div class=tab-pane id=taxonomyArchive role=tabpanel aria-labelledby=taxonomyArchiveTab tabindex=0><a href class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2023>2023 <span class="badge badge-sm text-secondary bg-white ms-1">2</span></a>
<a href=https://www.qinxiandiqi.sbs/archives/2022/ class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2022>2022 <span class="badge badge-sm text-secondary bg-white ms-1">7</span></a>
<a href=https://www.qinxiandiqi.sbs/archives/2021/ class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2021>2021 <span class="badge badge-sm text-secondary bg-white ms-1">1</span></a>
<a href=https://www.qinxiandiqi.sbs/archives/2020/ class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2020>2020 <span class="badge badge-sm text-secondary bg-white ms-1">2</span></a>
<a href=https://www.qinxiandiqi.sbs/archives/2018/ class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2018>2018 <span class="badge badge-sm text-secondary bg-white ms-1">7</span></a>
<a href=https://www.qinxiandiqi.sbs/archives/2017/ class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2017>2017 <span class="badge badge-sm text-secondary bg-white ms-1">2</span></a>
<a href=https://www.qinxiandiqi.sbs/archives/2016/ class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2016>2016 <span class="badge badge-sm text-secondary bg-white ms-1">7</span></a>
<a href=https://www.qinxiandiqi.sbs/archives/2015/ class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2015>2015 <span class="badge badge-sm text-secondary bg-white ms-1">21</span></a>
<a href=https://www.qinxiandiqi.sbs/archives/2014/ class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2014>2014 <span class="badge badge-sm text-secondary bg-white ms-1">93</span></a>
<a href=https://www.qinxiandiqi.sbs/archives/2012/ class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2012>2012 <span class="badge badge-sm text-secondary bg-white ms-1">6</span></a></div></div></div></section></div><div class="accordion posts-toggle"><section class="row card component accordion-item"><div class="accordion-header card-header border-0"><a class="accordion-button d-lg-none mb-1 collapsed shadow-none p-0 bg-transparent" type=button data-bs-toggle=collapse data-bs-target=#posts-toggle aria-expanded=false aria-controls=posts-toggle>文章</a></div><div class="card-body collapse accordion-collapse accordion-body d-lg-block" id=posts-toggle><ul class="nav nav-pills nav-fill" id=myTab role=tablist><li class=nav-item role=presentation><button class="nav-link active" id=recent-posts-tab data-bs-toggle=tab data-bs-target=#recent-posts type=button role=tab aria-controls=recent-posts aria-selected=true>
最近文章</button></li></ul><div class="tab-content mt-3"><div class="tab-pane active" id=recent-posts role=tabpanel aria-labelledby=recent-posts-tab tabindex=0><ul class="post-list list-unstyled ms-1"><li class=mb-2><div class=d-flex><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center"><a class=post-title href=https://www.qinxiandiqi.sbs/posts/android/adb%E7%9A%84%E5%A4%9A%E8%AE%BE%E5%A4%87%E6%93%8D%E4%BD%9C/>Adb的多设备操作</a><div class="post-meta mt-2"><span class=post-date>2023-01-08</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center"><a class=post-title href=https://www.qinxiandiqi.sbs/posts/android/%E4%BD%BF%E7%94%A8adb%E5%A4%8D%E5%88%B6%E6%96%87%E6%9C%AC%E5%88%B0%E8%AE%BE%E5%A4%87%E4%B8%8A/>使用adb复制文本到设备上</a><div class="post-meta mt-2"><span class=post-date>2023-01-05</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center"><a class=post-title href=https://www.qinxiandiqi.sbs/posts/%E7%AB%99%E9%95%BF%E4%BF%AE%E7%82%BC%E7%AC%94%E8%AE%B0/%E4%BF%9D%E6%8C%81ssh%E9%95%BF%E8%BF%9E%E6%8E%A5%E9%98%B2%E6%AD%A2%E5%8D%A1%E6%AD%BB/>保持SSH长连接防止终端卡死</a><div class="post-meta mt-2"><span class=post-date>2022-11-27</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center"><a class=post-title href=https://www.qinxiandiqi.sbs/posts/kotlin/%E5%BD%93%E9%80%89%E4%BD%9Ckey%E7%B1%BB%E5%9E%8B%E7%9A%84hashcode%E5%8F%AF%E5%8F%98%E6%97%B6hashmap%E4%BC%9A%E5%8F%91%E7%94%9F%E4%BB%80%E4%B9%88%E5%91%A2/>当选作key类型的hashCode可变时，HashMap会发生什么呢?</a><div class="post-meta mt-2"><span class=post-date>2022-11-07</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center"><a class=post-title href=https://www.qinxiandiqi.sbs/posts/android/%E6%9F%A5%E8%AF%A2apk%E7%9A%84%E7%AD%BE%E5%90%8D%E6%8C%87%E7%BA%B9/>查询apk的签名指纹</a><div class="post-meta mt-2"><span class=post-date>2022-11-04</span></div></div></div></li></ul></div></div></div></section></div><div class="accordion post-toc"><div class="accordion-item row mb-4 card component" id=postTOC><div class="card-header accordion-header"><h2 class="card-title fs-4 my-2 text-surface d-none d-lg-block">目录</h2><a class="accordion-button d-lg-none mb-1 collapsed shadow-none p-0 bg-transparent" type=button data-bs-toggle=collapse data-bs-target=#post-toc aria-expanded=false aria-controls=post-toc>目录</a></div><div class="card-body collapse accordion-collapse accordion-body d-lg-block" id=post-toc aria-labelledby=post-toc-header><nav id=TableOfContents><ul><li><a href=#步骤1写模板><strong>步骤1：写模板</strong></a></li><li><a href=#步骤2注解处理器读取model><strong>步骤2：注解处理器读取Model</strong></a></li><li><a href=#步骤3初始化velocity-context并加载模板><strong>步骤3：初始化Velocity Context并加载模板</strong></a></li><li><a href=#步骤4创建新的源文件并生成源代码><strong>步骤4：创建新的源文件并生成源代码</strong></a></li><li><a href=#步骤5打包并运行><strong>步骤5：打包并运行</strong></a></li></ul></nav></div></div></div></div></aside><div class=col-lg-8><div class=container><nav class="row card component" aria-label=breadcrumb><div class="card-body pb-0"><ol class=breadcrumb><li class="breadcrumb-item text-surface"><a href=https://www.qinxiandiqi.sbs/>主页</a></li><li class="breadcrumb-item text-surface"><a href=https://www.qinxiandiqi.sbs/posts/>Posts</a></li><li class="breadcrumb-item active">Java语言使用注解处理器生成代码——第三部分：生成源代码</li></ol></div></nav><div class="post-panel-wrapper position-sticky"><div class="d-flex flex-column component rounded post-panel position-absolute border"><a class="action action-panel-toggler" role=button title="Panel toggler"><i class="fas fa-fw fa-chevron-circle-down"></i></a>
<a id=sidebarToggler class="action d-none d-lg-block" role=button title="Sidebar toggler"><i class="fas fa-fw fa-expand-alt" data-fa-transform=rotate-45></i></a>
<a class="action btn-reward" role=button data-bs-toggle=modal data-bs-target=#rewardModal title=打赏><i class="fas fa-fw fa-coffee"></i></a>
<a class=action href=#post-copyright role=button aria-label=Copyright title=Copyright><i class="fas fa-fw fa-copyright"></i></a>
<a class=action href=#post-comments role=button aria-label=Comments title=Comments><i class="fas fa-fw fa-comments"></i></a>
<a class=action href=#postTOC aria-controls="Table of contents" role=button title="Table of contents"><i class="fas fa-fw fa-list-alt"></i></a></div></div><article class="row card component mb-4 post"><div class=card-header><h1 class="card-title post-title my-2">Java语言使用注解处理器生成代码——第三部分：生成源代码</h1></div><div class=card-body><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<script>window.onload=function(){var e=document.getElementById("busuanzi_value_page_pv"),t=parseInt(e.innerText),n=3343;e.innerText=t+n,console.log(t)}</script><div class="post-meta mb-3"><span class="post-date me-1 mb-1" title="创建于 2015-10-24 11:50:39 +0000 UTC。">2015-10-24</span><span class="post-reading-time me-1 mb-1">9 分钟阅读</span>
<span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span>次阅读</span><a href=https://www.qinxiandiqi.sbs/authors/jianan/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-author">
<i class="fas fa-fw fa-user me-1"></i>Jianan</a><a href=https://www.qinxiandiqi.sbs/categories/java/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-category">
<i class="fas fa-fw fa-folder me-1"></i>Java</a><a href=https://www.qinxiandiqi.sbs/categories/%E7%BF%BB%E8%AF%91/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-category">
<i class="fas fa-fw fa-folder me-1"></i>翻译</a><a href=https://www.qinxiandiqi.sbs/series/java/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-series">
<i class="fas fa-fw fa-columns me-1"></i>Java</a><a href=https://www.qinxiandiqi.sbs/tags/java/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-tag">Java</a><a href=https://www.qinxiandiqi.sbs/tags/%E6%BA%90%E4%BB%A3%E7%A0%81/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-tag">源代码</a><a href=https://www.qinxiandiqi.sbs/tags/%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-tag">注解处理器</a><a href=https://www.qinxiandiqi.sbs/tags/%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-tag">自动生成</a></div><div class="post-content mb-3" data-bs-spy=scroll data-bs-target=#TableOfContents tabindex=0><blockquote><p>原文作者：deors<br>原文地址：<a href=https://deors.wordpress.com/2011/10/31/annotation-generators/ target=_blank rel="noopener noreferrer">https://deors.wordpress.com/2011/10/31/annotation-generators/<i class="fas fa-external-link-square-alt ms-1"></i></a><br>译文作者：Jianan - <a href=mailto:qinxiandiqi@foxmail.com>qinxiandiqi@foxmail.com</a><br>版本信息：本文基于2015-10-12版本进行翻译<br>版权声明：本文经原文作者许可进行翻译，保留所有权利，未经允许不得复制和转载</p></blockquote><p>本文是我的“使用Java语言注解处理器生成代码”系列第三部分，也是最后一部分。在第一部分中（请阅读<a href=http://blog.csdn.net/qinxiandiqi/article/details/48999291 target=_blank rel="noopener noreferrer">这里<i class="fas fa-external-link-square-alt ms-1"></i></a>），我们介绍了什么是Java语言的注解，以及一些常用的方法。在第二部分中（请阅读<a href=http://blog.csdn.net/qinxiandiqi/article/details/49182735 target=_blank rel="noopener noreferrer">这里<i class="fas fa-external-link-square-alt ms-1"></i></a>），我们介绍了注解处理器，以及注解处理器如何创建和运行。</p><p>现在，在第三部分中，我们要学习如何使用注解处理器来生成源代码。</p><p>幸运的是从去年开始，MDE[1]（Model-Driven Engineering，也就是模型驱动工程设计，有时候也称为模型驱动开发或者模型驱动架构）已经有助于实践这个目标。这种设计更多的是倾向于艺术层面而不是科学——它针对的是经验丰富的程序员（译注：原文此句为task for ninja coders，国外有把经验丰富的程序员比作忍者的习惯）——是基于经过验证的流程和工具所提取出来的成熟方法论。</p><p>尽管我们可以认为生成源代码是MDE方法论的一个天然切入点，但是MDE涵盖的范围远远不止这些。</p><p>注解处理器只是众多我们用来生成源代码工具中的其中一种而已。</p><p>MDE的一个重要支柱就是它抽象的结构。我们将想要创建的软件系统在不同的细节层面使用不同的方法进行建模。当对一个抽象层建模之后，我们就可以对下一个和再下一个层面继续建模，直到一个可部署的产品被完整地建立起来。</p><p>从这个角度来看，无论我们使用的是哪一个细节层面，一个模型（覆盖的范围）都不会超过对应用来代表系统的抽象层。</p><p>元模型（meta-model），就是我们用来定义模型的规则。你可以认为它是模型的schema或者语法。</p><p>我们可以利用模型来生成配置文件或者从一个已存在的源文件中派生出一个新的源文件。例如，创建一个远程代理，或者为被注解的bean创建一个可访问内部数据的入口对象。</p><p>这种方法的核心在于注解处理器。一个处理器能够读取源代码中的所有注解——也就是提取模型，并且通过它能够做任何我们想要做的事情——打开文件并添加内容等。Java编译器会处理好模型验证的问题（注解必须匹配在注解处理器中注册的类型）。</p><p>在<strong>javax.annotation.processing.Filer</strong>[2]接口中定义了一些创建源文件、class文件或者生成资源的方法。通过使用Filer，我们可以确保使用了正确的文件目录，以避免丢失文件系统中生成的一些重要数据。</p><p>（另外，）我们需要关注的重点：一方面是考虑是否要写一个在javac上附加-d或者-s选项的生成器，另一方面就是Maven POM中定义文件夹。</p><p>下面是一个如何在注解处理器中创建Java源文件的例子。正如我们创建了一个Bean信息类，生成的类名与被注解的类名相同，只是在它后面添加上了“BeanInfo”后缀：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>if</span> <span class=o>(</span><span class=n>e</span><span class=o>.</span><span class=na>getKind</span><span class=o>()</span> <span class=o>==</span> <span class=n>ElementKind</span><span class=o>.</span><span class=na>CLASS</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>TypeElement</span> <span class=n>classElement</span> <span class=o>=</span> <span class=o>(</span><span class=n>TypeElement</span><span class=o>)</span> <span class=n>e</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>PackageElement</span> <span class=n>packageElement</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=o>(</span><span class=n>PackageElement</span><span class=o>)</span> <span class=n>classElement</span><span class=o>.</span><span class=na>getEnclosingElement</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>JavaFileObject</span> <span class=n>jfo</span> <span class=o>=</span> <span class=n>processingEnv</span><span class=o>.</span><span class=na>getFiler</span><span class=o>().</span><span class=na>createSourceFile</span><span class=o>(</span>
</span></span><span class=line><span class=cl>        <span class=n>classElement</span><span class=o>.</span><span class=na>getQualifiedName</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34;BeanInfo&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>BufferedWriter</span> <span class=n>bw</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BufferedWriter</span><span class=o>(</span><span class=n>jfo</span><span class=o>.</span><span class=na>openWriter</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=n>bw</span><span class=o>.</span><span class=na>append</span><span class=o>(</span><span class=s>&#34;package &#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>bw</span><span class=o>.</span><span class=na>append</span><span class=o>(</span><span class=n>packageElement</span><span class=o>.</span><span class=na>getQualifiedName</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=n>bw</span><span class=o>.</span><span class=na>append</span><span class=o>(</span><span class=s>&#34;;&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>bw</span><span class=o>.</span><span class=na>newLine</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>bw</span><span class=o>.</span><span class=na>newLine</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>// rest of generated class contents
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=o>}</span>
</span></span></code></pre></div><p>我们将从注解中获取所需信息（代表模型）的逻辑与生成文件（代表视图，译注：指的是MVC设计模式中的V层）的逻辑混合在一起。</p><p>使用这种方法很难写出一个像样的生成器。如果我们需要在这个过程加入更复杂的东西，那么这个过程就会变得非常繁杂，并且容易出错，也很难维护。</p><p>因此，我们需要一种更加优雅的方式：</p><ul><li>将模型从视图中清晰的分离出来。</li><li>使用模板来减轻生成文件的任务压力。</li></ul><p>让我们来看一个使用这种方式的例子：如何利用<strong>Apache Velocity</strong>来生成我们想要的生成器。</p><p>Velocity经常在当下流行的MVC模式中被用来渲染视图，或者在XML文件中作为XSLT的替代品进行数据转换。</p><p>Velocity拥有自己的语言，也就是Velocity Template Language（VLT），它是生成简单易读模板的关键。使用VLT，我们可以简单且直观地定义变量，控制流程和迭代，以及访问Java对象中包含的信息。</p><p>下面是一段Velocity模板片段：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=err>#</span><span class=n>foreach</span><span class=o>(</span><span class=n>$field</span> <span class=n>in</span> <span class=n>$fields</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * Returns the ${field.simpleName} property descriptor.
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @return the property descriptor
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>PropertyDescriptor</span> <span class=n>$</span><span class=o>{</span><span class=n>field</span><span class=o>.</span><span class=na>simpleName</span><span class=o>}</span><span class=n>PropertyDescriptor</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>PropertyDescriptor</span> <span class=n>theDescriptor</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>theDescriptor</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=n>end</span>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=n>foreach</span><span class=o>(</span><span class=n>$method</span> <span class=n>in</span> <span class=n>$methods</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * Returns the ${method.simpleName}() method descriptor.
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @return the method descriptor
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>MethodDescriptor</span> <span class=n>$</span><span class=o>{</span><span class=n>method</span><span class=o>.</span><span class=na>simpleName</span><span class=o>}</span><span class=n>MethodDescriptor</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>MethodDescriptor</span> <span class=n>descriptor</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>descriptor</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=n>end</span>
</span></span></code></pre></div><ul><li>写一个用来生成代码的模板。</li><li>注解处理器从每一轮的environment中读取被注解的元素并将它们保存到容易访问的Java对象中——包括一个保存field的map对象，一个保存method的map对象，类名和包名等等。</li><li>注解处理器实例化Velocity的context。</li><li>注解处理器加载Velocity的模板。</li><li>注解处理器创建源文件（通过使用Filer），并且连同Velocity Context将一个写入器（writer）传递给Velocity的模板。</li><li>Velocity引擎生成源代码。</li></ul><p>通过使用这种方法，你会发现处理器/生成器的代码非常清晰，结构良好，并且易于理解和维护。</p><p>下面让我们一步一步来实现：</p><h2 id=步骤1写模板 data-numberify>步骤1：写模板<a class="anchor ms-1 d-none" href=#步骤1写模板>#</a></h2><p>为了简单起见，我们不会列出完整的BeanInfo生成器代码，只是列出部分与注解处理器一块编译时需要的field（成员变量）和method（方法）。</p><p>接下来让我们创建一个名为<strong>beaninfo.vm</strong>的（模板）文件，并把它放到包含注解处理器的Maven artifact项目的<strong>src/main/resources</strong>目录下。模板内容的示例如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=err>${</span><span class=nn>packageName</span><span class=o>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.beans.MethodDescriptor</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.beans.ParameterDescriptor</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.beans.PropertyDescriptor</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.lang.reflect.Method</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>$</span><span class=o>{</span><span class=n>className</span><span class=o>}</span><span class=n>BeanInfo</span>
</span></span><span class=line><span class=cl>    <span class=kd>extends</span> <span class=n>java</span><span class=o>.</span><span class=na>beans</span><span class=o>.</span><span class=na>SimpleBeanInfo</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * Gets the bean class object.
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @return the bean class
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Class</span> <span class=nf>getBeanClass</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>$</span><span class=o>{</span><span class=n>packageName</span><span class=o>}.</span><span class=na>$</span><span class=o>{</span><span class=n>className</span><span class=o>}.</span><span class=na>class</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * Gets the bean class name.
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @return the bean class name
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>String</span> <span class=nf>getBeanClassName</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;${packageName}.${className}&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * Finds the right method by comparing name &amp; number of parameters in the class
</span></span></span><span class=line><span class=cl><span class=cm>     * method list.
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @param classObject the class object
</span></span></span><span class=line><span class=cl><span class=cm>     * @param methodName the method name
</span></span></span><span class=line><span class=cl><span class=cm>     * @param parameterCount the number of parameters
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @return the method if found, &lt;code&gt;null&lt;/code&gt; otherwise
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Method</span> <span class=nf>findMethod</span><span class=o>(</span><span class=n>Class</span> <span class=n>classObject</span><span class=o>,</span> <span class=n>String</span> <span class=n>methodName</span><span class=o>,</span> <span class=kt>int</span> <span class=n>parameterCount</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// since this method attempts to find a method by getting all
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>// methods from the class, this method should only be called if
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>// getMethod cannot find the method
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>Method</span><span class=o>[]</span> <span class=n>methods</span> <span class=o>=</span> <span class=n>classObject</span><span class=o>.</span><span class=na>getMethods</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=o>(</span><span class=n>Method</span> <span class=n>method</span> <span class=o>:</span> <span class=n>methods</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=o>(</span><span class=n>method</span><span class=o>.</span><span class=na>getParameterTypes</span><span class=o>().</span><span class=na>length</span> <span class=o>==</span> <span class=n>parameterCount</span>
</span></span><span class=line><span class=cl>                    <span class=o>&amp;&amp;</span> <span class=n>method</span><span class=o>.</span><span class=na>getName</span><span class=o>().</span><span class=na>equals</span><span class=o>(</span><span class=n>methodName</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=n>method</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Throwable</span> <span class=n>t</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=n>foreach</span><span class=o>(</span><span class=n>$field</span> <span class=n>in</span> <span class=n>$fields</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * Returns the ${field.simpleName} property descriptor.
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @return the property descriptor
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>PropertyDescriptor</span> <span class=n>$</span><span class=o>{</span><span class=n>field</span><span class=o>.</span><span class=na>simpleName</span><span class=o>}</span><span class=n>PropertyDescriptor</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>PropertyDescriptor</span> <span class=n>theDescriptor</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>theDescriptor</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=n>end</span>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=n>foreach</span><span class=o>(</span><span class=n>$method</span> <span class=n>in</span> <span class=n>$methods</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * Returns the ${method.simpleName}() method descriptor.
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @return the method descriptor
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>MethodDescriptor</span> <span class=n>$</span><span class=o>{</span><span class=n>method</span><span class=o>.</span><span class=na>simpleName</span><span class=o>}</span><span class=n>MethodDescriptor</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>MethodDescriptor</span> <span class=n>descriptor</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Method</span> <span class=n>method</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// finds the method using getMethod with parameter types
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>// TODO parameterize parameter types
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>Class</span><span class=o>[]</span> <span class=n>parameterTypes</span> <span class=o>=</span> <span class=o>{</span><span class=n>java</span><span class=o>.</span><span class=na>beans</span><span class=o>.</span><span class=na>PropertyChangeListener</span><span class=o>.</span><span class=na>class</span><span class=o>};</span>
</span></span><span class=line><span class=cl>            <span class=n>method</span> <span class=o>=</span> <span class=n>getBeanClass</span><span class=o>().</span><span class=na>getMethod</span><span class=o>(</span><span class=s>&#34;${method.simpleName}&#34;</span><span class=o>,</span> <span class=n>parameterTypes</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Throwable</span> <span class=n>t</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// alternative: use findMethod
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>// TODO parameterize number of parameters
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>method</span> <span class=o>=</span> <span class=n>findMethod</span><span class=o>(</span><span class=n>getBeanClass</span><span class=o>(),</span> <span class=s>&#34;${method.simpleName}&#34;</span><span class=o>,</span> <span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// creates the method descriptor with parameter descriptors
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>// TODO parameterize parameter descriptors
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>ParameterDescriptor</span> <span class=n>parameterDescriptor1</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ParameterDescriptor</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>parameterDescriptor1</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;listener&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>parameterDescriptor1</span><span class=o>.</span><span class=na>setDisplayName</span><span class=o>(</span><span class=s>&#34;listener&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>ParameterDescriptor</span><span class=o>[]</span> <span class=n>parameterDescriptors</span> <span class=o>=</span> <span class=o>{</span><span class=n>parameterDescriptor1</span><span class=o>};</span>
</span></span><span class=line><span class=cl>            <span class=n>descriptor</span> <span class=o>=</span> <span class=k>new</span> <span class=n>MethodDescriptor</span><span class=o>(</span><span class=n>method</span><span class=o>,</span> <span class=n>parameterDescriptors</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Throwable</span> <span class=n>t</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// alternative: create a plain method descriptor
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>descriptor</span> <span class=o>=</span> <span class=k>new</span> <span class=n>MethodDescriptor</span><span class=o>(</span><span class=n>method</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO parameterize descriptor properties
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>descriptor</span><span class=o>.</span><span class=na>setDisplayName</span><span class=o>(</span><span class=s>&#34;${method.simpleName}(java.beans.PropertyChangeListener)&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>descriptor</span><span class=o>.</span><span class=na>setShortDescription</span><span class=o>(</span><span class=s>&#34;Adds a property change listener.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>descriptor</span><span class=o>.</span><span class=na>setExpert</span><span class=o>(</span><span class=kc>false</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>descriptor</span><span class=o>.</span><span class=na>setHidden</span><span class=o>(</span><span class=kc>false</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>descriptor</span><span class=o>.</span><span class=na>setValue</span><span class=o>(</span><span class=s>&#34;preferred&#34;</span><span class=o>,</span> <span class=kc>false</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>descriptor</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=n>end</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>注意在这个模板运作之前，我们需要将以下信息传递给Velocity：</p><ul><li>packageName：生成类的完整包名。</li><li>className：生成类的类名。</li><li>fields：源类中包含的filed的集合。我们需要从每个field中获取以下信息：<ul><li>simpleName：filed的变量名。</li><li>type：filed的类型。</li><li>description：filed的自我描述（在本例中没有使用）</li><li>……</li></ul></li><li>methods：源类中包含的method的集合。我们需要从每个method中获取以下信息：<ul><li>simpleName：method的方法名。</li><li>arguments：method的参数（在本例中没有使用）</li><li>returnType：method的返回类型（在本例中没有使用）</li><li>description：method的自我描述（在本例中没有使用）</li><li>……</li></ul></li></ul><p>所有的这些信息（也就是模型）都需要从源类里面匹配的注解中提取，并保存到JavaBean后传递给Velocity。</p><h2 id=步骤2注解处理器读取model data-numberify>步骤2：注解处理器读取Model<a class="anchor ms-1 d-none" href=#步骤2注解处理器读取model>#</a></h2><p>下面让我们创建一个注解处理器。正如本系列第二部分中所提到的，不要忘记给处理器添加注解，好让它能够处理BeanInfo注解类型：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@SupportedAnnotationTypes</span><span class=o>(</span><span class=s>&#34;example.annotations.beaninfo.BeanInfo&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nd>@SupportedSourceVersion</span><span class=o>(</span><span class=n>SourceVersion</span><span class=o>.</span><span class=na>RELEASE_6</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>BeanInfoProcessor</span>
</span></span><span class=line><span class=cl>    <span class=kd>extends</span> <span class=n>AbstractProcessor</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>注解处理器的方法需要从注解和源类本身中提取构建模型所需要的信息。你可以将全部需要的信息都保存到JavaBean里面，不过在这个示例中我们使用的是<strong>javax.lang.model.element</strong>类型，因为我们不打算传递太多细节给Velocity（当然，需要的数据还是会传递过去的，在这个例子中我们要创建的是一个完整的BeanInfo生成器）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span> <span class=n>fqClassName</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=n>String</span> <span class=n>className</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=n>String</span> <span class=n>packageName</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>VariableElement</span><span class=o>&gt;</span> <span class=n>fields</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>VariableElement</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>ExecutableElement</span><span class=o>&gt;</span> <span class=n>methods</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>ExecutableElement</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=o>(</span><span class=n>Element</span> <span class=n>e</span> <span class=o>:</span> <span class=n>roundEnv</span><span class=o>.</span><span class=na>getElementsAnnotatedWith</span><span class=o>(</span><span class=n>BeanInfo</span><span class=o>.</span><span class=na>class</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>e</span><span class=o>.</span><span class=na>getKind</span><span class=o>()</span> <span class=o>==</span> <span class=n>ElementKind</span><span class=o>.</span><span class=na>CLASS</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>TypeElement</span> <span class=n>classElement</span> <span class=o>=</span> <span class=o>(</span><span class=n>TypeElement</span><span class=o>)</span> <span class=n>e</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>PackageElement</span> <span class=n>packageElement</span> <span class=o>=</span> <span class=o>(</span><span class=n>PackageElement</span><span class=o>)</span> <span class=n>classElement</span><span class=o>.</span><span class=na>getEnclosingElement</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>processingEnv</span><span class=o>.</span><span class=na>getMessager</span><span class=o>().</span><span class=na>printMessage</span><span class=o>(</span>
</span></span><span class=line><span class=cl>            <span class=n>Diagnostic</span><span class=o>.</span><span class=na>Kind</span><span class=o>.</span><span class=na>NOTE</span><span class=o>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;annotated class: &#34;</span> <span class=o>+</span> <span class=n>classElement</span><span class=o>.</span><span class=na>getQualifiedName</span><span class=o>(),</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>fqClassName</span> <span class=o>=</span> <span class=n>classElement</span><span class=o>.</span><span class=na>getQualifiedName</span><span class=o>().</span><span class=na>toString</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>className</span> <span class=o>=</span> <span class=n>classElement</span><span class=o>.</span><span class=na>getSimpleName</span><span class=o>().</span><span class=na>toString</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>packageName</span> <span class=o>=</span> <span class=n>packageElement</span><span class=o>.</span><span class=na>getQualifiedName</span><span class=o>().</span><span class=na>toString</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>e</span><span class=o>.</span><span class=na>getKind</span><span class=o>()</span> <span class=o>==</span> <span class=n>ElementKind</span><span class=o>.</span><span class=na>FIELD</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>VariableElement</span> <span class=n>varElement</span> <span class=o>=</span> <span class=o>(</span><span class=n>VariableElement</span><span class=o>)</span> <span class=n>e</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>processingEnv</span><span class=o>.</span><span class=na>getMessager</span><span class=o>().</span><span class=na>printMessage</span><span class=o>(</span>
</span></span><span class=line><span class=cl>            <span class=n>Diagnostic</span><span class=o>.</span><span class=na>Kind</span><span class=o>.</span><span class=na>NOTE</span><span class=o>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;annotated field: &#34;</span> <span class=o>+</span> <span class=n>varElement</span><span class=o>.</span><span class=na>getSimpleName</span><span class=o>(),</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>fields</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>varElement</span><span class=o>.</span><span class=na>getSimpleName</span><span class=o>().</span><span class=na>toString</span><span class=o>(),</span> <span class=n>varElement</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>e</span><span class=o>.</span><span class=na>getKind</span><span class=o>()</span> <span class=o>==</span> <span class=n>ElementKind</span><span class=o>.</span><span class=na>METHOD</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ExecutableElement</span> <span class=n>exeElement</span> <span class=o>=</span> <span class=o>(</span><span class=n>ExecutableElement</span><span class=o>)</span> <span class=n>e</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>processingEnv</span><span class=o>.</span><span class=na>getMessager</span><span class=o>().</span><span class=na>printMessage</span><span class=o>(</span>
</span></span><span class=line><span class=cl>            <span class=n>Diagnostic</span><span class=o>.</span><span class=na>Kind</span><span class=o>.</span><span class=na>NOTE</span><span class=o>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;annotated method: &#34;</span> <span class=o>+</span> <span class=n>exeElement</span><span class=o>.</span><span class=na>getSimpleName</span><span class=o>(),</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>methods</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>exeElement</span><span class=o>.</span><span class=na>getSimpleName</span><span class=o>().</span><span class=na>toString</span><span class=o>(),</span> <span class=n>exeElement</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=步骤3初始化velocity-context并加载模板 data-numberify>步骤3：初始化Velocity Context并加载模板<a class="anchor ms-1 d-none" href=#步骤3初始化velocity-context并加载模板>#</a></h2><p>下面的代码片段展示了如何初始化Velocity Context并加载模板：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>if</span> <span class=o>(</span><span class=n>fqClassName</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Properties</span> <span class=n>props</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Properties</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>URL</span> <span class=n>url</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>getClass</span><span class=o>().</span><span class=na>getClassLoader</span><span class=o>().</span><span class=na>getResource</span><span class=o>(</span><span class=s>&#34;velocity.properties&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>props</span><span class=o>.</span><span class=na>load</span><span class=o>(</span><span class=n>url</span><span class=o>.</span><span class=na>openStream</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>VelocityEngine</span> <span class=n>ve</span> <span class=o>=</span> <span class=k>new</span> <span class=n>VelocityEngine</span><span class=o>(</span><span class=n>props</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>ve</span><span class=o>.</span><span class=na>init</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>VelocityContext</span> <span class=n>vc</span> <span class=o>=</span> <span class=k>new</span> <span class=n>VelocityContext</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>vc</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;className&#34;</span><span class=o>,</span> <span class=n>className</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>vc</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;packageName&#34;</span><span class=o>,</span> <span class=n>packageName</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>vc</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;fields&#34;</span><span class=o>,</span> <span class=n>fields</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>vc</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;methods&#34;</span><span class=o>,</span> <span class=n>methods</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Template</span> <span class=n>vt</span> <span class=o>=</span> <span class=n>ve</span><span class=o>.</span><span class=na>getTemplate</span><span class=o>(</span><span class=s>&#34;beaninfo.vm&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>Velocity配置文件，在本示例中名为<strong>velocity.properties</strong>，它应该被放置到<strong>src/main/resources</strong>目录下。下面是它的内容示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>runtime</span><span class=o>.</span><span class=na>log</span><span class=o>.</span><span class=na>logsystem</span><span class=o>.</span><span class=na>class</span> <span class=o>=</span> <span class=n>org</span><span class=o>.</span><span class=na>apache</span><span class=o>.</span><span class=na>velocity</span><span class=o>.</span><span class=na>runtime</span><span class=o>.</span><span class=na>log</span><span class=o>.</span><span class=na>SystemLogChute</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>resource</span><span class=o>.</span><span class=na>loader</span> <span class=o>=</span> <span class=n>classpath</span>
</span></span><span class=line><span class=cl><span class=n>classpath</span><span class=o>.</span><span class=na>resource</span><span class=o>.</span><span class=na>loader</span><span class=o>.</span><span class=na>class</span> <span class=o>=</span> <span class=n>org</span><span class=o>.</span><span class=na>apache</span><span class=o>.</span><span class=na>velocity</span><span class=o>.</span><span class=na>runtime</span><span class=o>.</span><span class=na>resource</span><span class=o>.</span><span class=na>loader</span><span class=o>.</span><span class=na>ClasspathResourceLoader</span>
</span></span></code></pre></div><p>这组属性配置了Velocity的日志，以及一个用于查找模板的基本资源加载路径。</p><h2 id=步骤4创建新的源文件并生成源代码 data-numberify>步骤4：创建新的源文件并生成源代码<a class="anchor ms-1 d-none" href=#步骤4创建新的源文件并生成源代码>#</a></h2><p>紧接着，让我们创建新的源文件，并将这个新文件作为模板的目标来运行模板。下面的代码片段展示了如何操作：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>JavaFileObject</span> <span class=n>jfo</span> <span class=o>=</span> <span class=n>processingEnv</span><span class=o>.</span><span class=na>getFiler</span><span class=o>().</span><span class=na>createSourceFile</span><span class=o>(</span>
</span></span><span class=line><span class=cl>    <span class=n>fqClassName</span> <span class=o>+</span> <span class=s>&#34;BeanInfo&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>processingEnv</span><span class=o>.</span><span class=na>getMessager</span><span class=o>().</span><span class=na>printMessage</span><span class=o>(</span>
</span></span><span class=line><span class=cl>    <span class=n>Diagnostic</span><span class=o>.</span><span class=na>Kind</span><span class=o>.</span><span class=na>NOTE</span><span class=o>,</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;creating source file: &#34;</span> <span class=o>+</span> <span class=n>jfo</span><span class=o>.</span><span class=na>toUri</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Writer</span> <span class=n>writer</span> <span class=o>=</span> <span class=n>jfo</span><span class=o>.</span><span class=na>openWriter</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>processingEnv</span><span class=o>.</span><span class=na>getMessager</span><span class=o>().</span><span class=na>printMessage</span><span class=o>(</span>
</span></span><span class=line><span class=cl>    <span class=n>Diagnostic</span><span class=o>.</span><span class=na>Kind</span><span class=o>.</span><span class=na>NOTE</span><span class=o>,</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;applying velocity template: &#34;</span> <span class=o>+</span> <span class=n>vt</span><span class=o>.</span><span class=na>getName</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>vt</span><span class=o>.</span><span class=na>merge</span><span class=o>(</span><span class=n>vc</span><span class=o>,</span> <span class=n>writer</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>writer</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
</span></span></code></pre></div><h2 id=步骤5打包并运行 data-numberify>步骤5：打包并运行<a class="anchor ms-1 d-none" href=#步骤5打包并运行>#</a></h2><p>最后，注册注解处理器（记得添加本系列第二部分中提到过的service配置文件），然后打包。再通过终端命令行，Eclipse或者Maven工具在client（客户）项目中进行调用和编译。</p><p>假设client项目中的client类如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>example.velocity.client</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>example.annotations.beaninfo.BeanInfo</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=nd>@BeanInfo</span> <span class=kd>public</span> <span class=kd>class</span> <span class=nc>Article</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@BeanInfo</span> <span class=kd>private</span> <span class=n>String</span> <span class=n>id</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=nd>@BeanInfo</span> <span class=kd>private</span> <span class=kt>int</span> <span class=n>department</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=nd>@BeanInfo</span> <span class=kd>private</span> <span class=n>String</span> <span class=n>status</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>Article</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getId</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>id</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setId</span><span class=o>(</span><span class=n>String</span> <span class=n>id</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>id</span> <span class=o>=</span> <span class=n>id</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>getDepartment</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>department</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setDepartment</span><span class=o>(</span><span class=kt>int</span> <span class=n>department</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>department</span> <span class=o>=</span> <span class=n>department</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getStatus</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>status</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setStatus</span><span class=o>(</span><span class=n>String</span> <span class=n>status</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>status</span> <span class=o>=</span> <span class=n>status</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@BeanInfo</span> <span class=kd>public</span> <span class=kt>void</span> <span class=nf>activate</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>setStatus</span><span class=o>(</span><span class=s>&#34;active&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@BeanInfo</span> <span class=kd>public</span> <span class=kt>void</span> <span class=nf>deactivate</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>setStatus</span><span class=o>(</span><span class=s>&#34;inactive&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>当我们在终端上执行<strong>javac</strong>命令后，我们可以在控制台上看到找到的被注解元素，以及生成的BeanInfo类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=no>Article</span><span class=o>.</span><span class=n>java</span><span class=p>:</span><span class=mi>6</span><span class=p>:</span> <span class=ss>Note</span><span class=p>:</span> <span class=n>annotated</span> <span class=ss>class</span><span class=p>:</span> <span class=n>example</span><span class=o>.</span><span class=n>annotations</span><span class=o>.</span><span class=n>velocity</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>Article</span>
</span></span><span class=line><span class=cl><span class=kp>public</span> <span class=k>class</span> <span class=nc>Article</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>       <span class=o>^</span>
</span></span><span class=line><span class=cl><span class=no>Article</span><span class=o>.</span><span class=n>java</span><span class=p>:</span><span class=mi>9</span><span class=p>:</span> <span class=ss>Note</span><span class=p>:</span> <span class=n>annotated</span> <span class=ss>field</span><span class=p>:</span> <span class=nb>id</span>
</span></span><span class=line><span class=cl>    <span class=kp>private</span> <span class=nb>String</span> <span class=nb>id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                   <span class=o>^</span>
</span></span><span class=line><span class=cl><span class=no>Article</span><span class=o>.</span><span class=n>java</span><span class=p>:</span><span class=mi>12</span><span class=p>:</span> <span class=ss>Note</span><span class=p>:</span> <span class=n>annotated</span> <span class=ss>field</span><span class=p>:</span> <span class=n>department</span>
</span></span><span class=line><span class=cl>    <span class=kp>private</span> <span class=n>int</span> <span class=n>department</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=o>^</span>
</span></span><span class=line><span class=cl><span class=no>Article</span><span class=o>.</span><span class=n>java</span><span class=p>:</span><span class=mi>15</span><span class=p>:</span> <span class=ss>Note</span><span class=p>:</span> <span class=n>annotated</span> <span class=ss>field</span><span class=p>:</span> <span class=n>status</span>
</span></span><span class=line><span class=cl>    <span class=kp>private</span> <span class=nb>String</span> <span class=n>status</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                   <span class=o>^</span>
</span></span><span class=line><span class=cl><span class=no>Article</span><span class=o>.</span><span class=n>java</span><span class=p>:</span><span class=mi>53</span><span class=p>:</span> <span class=ss>Note</span><span class=p>:</span> <span class=n>annotated</span> <span class=nb>method</span><span class=p>:</span> <span class=n>activate</span>
</span></span><span class=line><span class=cl>    <span class=kp>public</span> <span class=n>void</span> <span class=n>activate</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=o>^</span>
</span></span><span class=line><span class=cl><span class=no>Article</span><span class=o>.</span><span class=n>java</span><span class=p>:</span><span class=mi>59</span><span class=p>:</span> <span class=ss>Note</span><span class=p>:</span> <span class=n>annotated</span> <span class=nb>method</span><span class=p>:</span> <span class=n>deactivate</span>
</span></span><span class=line><span class=cl>    <span class=kp>public</span> <span class=n>void</span> <span class=n>deactivate</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=o>^</span>
</span></span><span class=line><span class=cl><span class=ss>Note</span><span class=p>:</span> <span class=n>creating</span> <span class=n>source</span> <span class=ss>file</span><span class=p>:</span> <span class=ss>file</span><span class=p>:</span><span class=sr>/c:/</span><span class=n>projects</span><span class=o>/</span><span class=n>example</span><span class=o>.</span><span class=n>annotations</span><span class=o>.</span><span class=n>velocity</span><span class=o>.</span><span class=n>client</span><span class=o>/</span><span class=n>src</span><span class=o>/</span><span class=n>main</span><span class=o>/</span><span class=n>java</span><span class=o>/</span><span class=n>example</span><span class=o>/</span><span class=n>annotations</span><span class=o>/</span><span class=n>velocity</span><span class=o>/</span><span class=n>client</span><span class=o>/</span><span class=no>ArticleBeanInfo</span><span class=o>.</span><span class=n>java</span>
</span></span><span class=line><span class=cl><span class=ss>Note</span><span class=p>:</span> <span class=n>applying</span> <span class=n>velocity</span> <span class=ss>template</span><span class=p>:</span> <span class=n>beaninfo</span><span class=o>.</span><span class=n>vm</span>
</span></span><span class=line><span class=cl><span class=ss>Note</span><span class=p>:</span> <span class=n>example</span><span class=p>\</span><span class=n>annotations</span><span class=p>\</span><span class=n>velocity</span><span class=p>\</span><span class=n>client</span><span class=p>\</span><span class=no>ArticleBeanInfo</span><span class=o>.</span><span class=n>java</span> <span class=n>uses</span> <span class=n>unchecked</span> <span class=ow>or</span> <span class=n>unsafe</span> <span class=n>operations</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=ss>Note</span><span class=p>:</span> <span class=no>Recompile</span> <span class=n>with</span> <span class=o>-</span><span class=ss>Xlint</span><span class=p>:</span><span class=n>unchecked</span> <span class=k>for</span> <span class=n>details</span><span class=o>.</span>
</span></span></code></pre></div><p>如果我们检查下源代码目录，我们将会找到我们生成的BeanInfo类。任务完成！</p><ul><li>我们学习了什么是注解和注解类型，以及它们的常用方式。</li><li>我们学习了什么是注解处理器，如何写注解处理器，以及如何使用不同的工具运行注解处理器——Java编译器、Eclipse或者Maven。</li><li>我们讨论了一点关于模型驱动设计与代码生成的技术。</li><li>我们介绍了如何使用注解处理器创建能够与Java编译器完全交互的源代码生成器。</li><li>我们介绍了如何利用现有的生成框架（像Apache Velocity）基于注解处理器来创建优雅强大且易于维护的源代码生成器。</li></ul><p>现在，是时候将这些内容应用到你的项目中了。思考一下生成技术！</p><hr><p>[1]：如果你想要了解更多关于MDE的内容，请参考维基百科的这篇<a href=http://en.wikipedia.org/wiki/Model-driven_engineering target=_blank rel="noopener noreferrer">文章<i class="fas fa-external-link-square-alt ms-1"></i></a>以及它的参考文献。<br>[2]：Filer的API文档可以在<a href=http://download.oracle.com/javase/6/docs/api/javax/annotation/processing/Filer.html target=_blank rel="noopener noreferrer">这里<i class="fas fa-external-link-square-alt ms-1"></i></a>在线查看。</p></div><div class="modal fade" id=rewardModal tabindex=-1 aria-labelledby=rewardModalLabel aria-hidden=true><div class=modal-dialog><div class="modal-content surface"><div class=modal-header><h5 class="modal-title text-surface" id=rewardModalLabel><i class="fas fa-fw fa-coffee me-1"></i>打赏</h5><a href=# data-bs-dismiss=modal class=btn-close aria-label=Close></a></div><div class=modal-body><ul class="nav nav-tabs mb-3" role=tablist><li class="nav-item text-nowrap" role=presentation><a class="nav-link active" id=reward-alipay-tab data-bs-toggle=tab href=#reward-alipay role=tab aria-controls=reward-alipay aria-selected=true><i class="fab fa-fw fa-alipay me-1"></i>支付宝</a></li><li class="nav-item text-nowrap" role=presentation><a class=nav-link id=reward-wechat-tab data-bs-toggle=tab href=#reward-wechat role=tab aria-controls=reward-wechat aria-selected=true><i class="fab fa-fw fa-weixin me-1"></i>微信</a></li></ul><div class=tab-content id=rewardTabContent><div class="tab-pane fade post-reward-content text-center show active" id=reward-alipay role=tabpanel aria-labelledby=reward-alipay-tab><img class="img-fluid post-reward-img" src=https://www.qinxiandiqi.sbs/images/reward/alipay.jpg loading=lazy data-viewer-invisible></div><div class="tab-pane fade post-reward-content text-center show" id=reward-wechat role=tabpanel aria-labelledby=reward-wechat-tab><img class="img-fluid post-reward-img" src=https://www.qinxiandiqi.sbs/images/reward/wechat.png loading=lazy data-viewer-invisible></div></div></div></div></div></div></div><div class=card-footer><div class="post-navs d-flex justify-content-evenly"><div class="post-nav post-prev"><i class="fas fa-fw fa-chevron-down post-prev-icon me-1" data-fa-transform=rotate-90></i>
<a href=https://www.qinxiandiqi.sbs/posts/android/android%E7%9A%84%E5%B1%8F%E5%B9%95%E5%A4%9A%E6%A0%B7%E6%80%A7%E6%94%AF%E6%8C%81/>Android的屏幕多样性支持</a></div><div class="post-nav post-next"><a href=https://www.qinxiandiqi.sbs/posts/system/%E5%9C%A8u%E7%9B%98%E4%B8%8A%E5%AE%89%E8%A3%85chromiumos/>在U盘上安装ChromiumOS</a>
<i class="fas fa-fw fa-chevron-down post-next-icon ms-1" data-fa-transform=rotate-270></i></div></div></div></article><div class="post-copyright mb-3 row card component" id=post-copyright><div class=card-header><h2 class="card-title fs-4 my-2 text-surface">版权</h2></div><div class=card-body><a class="d-flex align-items-center flex-column" target=_blank rel="license noopener noreferrer" href=https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh><span><i class="fab fa-fw fa-2x fa-creative-commons"></i><i class="fab fa-fw fa-2x fa-creative-commons-by"></i><i class="fab fa-fw fa-2x fa-creative-commons-nc"></i><i class="fab fa-fw fa-2x fa-creative-commons-nd"></i></span>
CC BY-NC-ND 4.0</a></div></div><section class="related-posts row card component"><div class=card-header><h2 class="card-title fs-4 my-2 text-surface">相关文章</h2></div><div class=card-body><ul class="post-list list-unstyled"><li class="mb-3 border-bottom"><a class=post-title href=https://www.qinxiandiqi.sbs/posts/java/java%E8%AF%AD%E8%A8%80%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81/java%E8%AF%AD%E8%A8%80%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8/>Java语言使用注解处理器生成代码——第二部分：注解处理器</a>
<span class="post-meta post-date float-end">2015-10-16</span><div class="post-summary my-3"><p>本文是我的“关于Java语言使用注解处理器生成代码”系列第二部分。在第一部分中（请阅读这里)，我们介绍了什么是Java语言的注解，以及它们的几种常用方式。
现在，在这第二部分中，我们将介绍注解处理器。包括如何创建注解处理器，以及如何运行它们。</p><div><a class="btn btn-sm btn-outline-primary btn-read-more" href=https://www.qinxiandiqi.sbs/posts/java/java%E8%AF%AD%E8%A8%80%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81/java%E8%AF%AD%E8%A8%80%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8/>阅读更多</a></div></div></li><li class="mb-3 border-bottom"><a class=post-title href=https://www.qinxiandiqi.sbs/posts/java/java%E8%AF%AD%E8%A8%80%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81/java%E8%AF%AD%E8%A8%80%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%E6%B3%A8%E8%A7%A3%E7%B1%BB%E5%9E%8B/>Java语言使用注解处理器生成代码 —— 第一部分：注解类型</a>
<span class="post-meta post-date float-end">2015-10-09</span><div class="post-summary my-3"><p>从本文开始，我将开始写一系列关于Java语言使用注解处理器生成代码的文章，包括这种方法的强大之处。最后还会描述如何确保在编译的时候使用这种方法生成源代码。在这系列文章中，我们将会： 介绍Java语言的注解。 了解注解的常用方式以及使用范围。 了解注解处理器以及它们所代表的角色。 学习如何创建注解处理器。 学习如何在终端命令行、Eclipse和Maven中运行注解处理器。 学习如何使用注解处理器生成源</p><div><a class="btn btn-sm btn-outline-primary btn-read-more" href=https://www.qinxiandiqi.sbs/posts/java/java%E8%AF%AD%E8%A8%80%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81/java%E8%AF%AD%E8%A8%80%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%E6%B3%A8%E8%A7%A3%E7%B1%BB%E5%9E%8B/>阅读更多</a></div></div></li><li class="mb-3 border-bottom"><a class=post-title href=https://www.qinxiandiqi.sbs/posts/golang/%E5%9C%A8arm%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85golang/>在ARM平台上编译安装golang</a>
<span class="post-meta post-date float-end">2015-01-20</span><div class="post-summary my-3"><p>golang也就是go语言，现在已经发行到1.4.1版本了，语言特性优越性和背后google强大靠山什么的就不多说了。golang的官方提供了多个平台上的二进制安装包，遗憾的是并非没有发布ARM平台的二进制安装包。ARM平台没办法直接从官网下载二进制安装包来安装，好在golang是支持多平台并且开源的语言，因此可以通过直接在ARM平台上编译源代码来安装。整个过程主要包括编译工具配置、获取golan</p><div><a class="btn btn-sm btn-outline-primary btn-read-more" href=https://www.qinxiandiqi.sbs/posts/golang/%E5%9C%A8arm%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85golang/>阅读更多</a></div></div></li><li class="mb-3 border-bottom"><a class=post-title href=https://www.qinxiandiqi.sbs/posts/java/gson%E7%94%A8%E6%88%B7%E6%8C%87%E5%8D%97/>Gson用户指南</a>
<span class="post-meta post-date float-end">2014-09-07</span><div class="post-summary my-3"><p>作者：Inderjeet Singh, Joel Leitch, Jesse Wilson
1、Overview（概览）
Gson是一个Java类库，用于将Java对象转换为它们所代表的JSON数据，也可以用于将一个JSON字符串转换为对应的Java对象。Gson是一个开源项目，托管于http://code.google.com/p/google-gson。
Gson可以用于任意</p><div><a class="btn btn-sm btn-outline-primary btn-read-more" href=https://www.qinxiandiqi.sbs/posts/java/gson%E7%94%A8%E6%88%B7%E6%8C%87%E5%8D%97/>阅读更多</a></div></div></li><li class="mb-3 border-bottom"><a class=post-title href=https://www.qinxiandiqi.sbs/posts/ant%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/>Ant学习笔记</a>
<span class="post-meta post-date float-end">2014-07-11</span><div class="post-summary my-3"><p>1、Ant（another neat tool）是一个基于Java的生成工具，其作用类似于命令的批处理，通过设置一个xml文件后，Ant将会执行xml文件中指定的系列命令。这对于随着应用程序的生成过程变得更加复杂，又需要确保在每次生成期间都使用精确相同的生成步骤，同时实现尽可能多的自动化，以便于及时产生一致的生成版本非常重要。
2、Ant是基于命令行操作的。单纯使用ant命令时，Ant将会在</p><div><a class="btn btn-sm btn-outline-primary btn-read-more" href=https://www.qinxiandiqi.sbs/posts/ant%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/>阅读更多</a></div></div></li></ul></div></section><div class="card component row post-comments" id=post-comments><div class=card-header><h2 class="card-title my-2 fs-4 text-surface">评论</h2></div><div class=card-body><script src=https://utteranc.es/client.js repo=qinxiandiqi/qinxiandiqi.github.io issue-term=pathname label=comment theme=github-light crossorigin=anonymous async></script></div></div></div></div></div></main><footer class="footer mt-auto py-3 text-center container"><div class="offcanvas offcanvas-bottom h-auto" tabindex=-1 id=offcanvasActionsPanel aria-labelledby=offcanvasActionsPanelLabel><div class=offcanvas-header><h5 class="offcanvas-title fs-4" id=offcanvasActionsPanelLabel><i class="fas fa-fw fa-th-large me-1"></i>
操作</h5><button type=button class="btn-close ms-auto" data-bs-dismiss=offcanvas data-bs-target=offcanvasActionsPanel aria-label=Close></button></div><div class="offcanvas-body mt-2"><div class="social-share mb-4 d-flex overflow-auto"><a class="btn-social-share d-flex flex-column align-items-center me-3" rel="noopener noreferrer" aria-label="Twitter Share Button" target=_blank href="https://twitter.com/intent/tweet?title=Java%e8%af%ad%e8%a8%80%e4%bd%bf%e7%94%a8%e6%b3%a8%e8%a7%a3%e5%a4%84%e7%90%86%e5%99%a8%e7%94%9f%e6%88%90%e4%bb%a3%e7%a0%81%e2%80%94%e2%80%94%e7%ac%ac%e4%b8%89%e9%83%a8%e5%88%86%ef%bc%9a%e7%94%9f%e6%88%90%e6%ba%90%e4%bb%a3%e7%a0%81&url=https%3a%2f%2fwww.qinxiandiqi.sbs%2fposts%2fjava%2fjava%25E8%25AF%25AD%25E8%25A8%2580%25E4%25BD%25BF%25E7%2594%25A8%25E6%25B3%25A8%25E8%25A7%25A3%25E5%25A4%2584%25E7%2590%2586%25E5%2599%25A8%25E7%2594%259F%25E6%2588%2590%25E4%25BB%25A3%25E7%25A0%2581%2fjava%25E8%25AF%25AD%25E8%25A8%2580%25E4%25BD%25BF%25E7%2594%25A8%25E6%25B3%25A8%25E8%25A7%25A3%25E5%25A4%2584%25E7%2590%2586%25E5%2599%25A8%25E7%2594%259F%25E6%2588%2590%25E4%25BB%25A3%25E7%25A0%2581%25E7%25AC%25AC%25E4%25B8%2589%25E9%2583%25A8%25E5%2588%2586%25E7%2594%259F%25E6%2588%2590%25E6%25BA%2590%25E4%25BB%25A3%25E7%25A0%2581%2f"><i class="fab fa-2x fa-fw fa-twitter mb-2"></i> Twitter</a>
<a class="btn-social-share d-flex flex-column align-items-center me-3" rel="noopener noreferrer" aria-label="Facebook Share Button" target=_blank href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.qinxiandiqi.sbs%2fposts%2fjava%2fjava%25E8%25AF%25AD%25E8%25A8%2580%25E4%25BD%25BF%25E7%2594%25A8%25E6%25B3%25A8%25E8%25A7%25A3%25E5%25A4%2584%25E7%2590%2586%25E5%2599%25A8%25E7%2594%259F%25E6%2588%2590%25E4%25BB%25A3%25E7%25A0%2581%2fjava%25E8%25AF%25AD%25E8%25A8%2580%25E4%25BD%25BF%25E7%2594%25A8%25E6%25B3%25A8%25E8%25A7%25A3%25E5%25A4%2584%25E7%2590%2586%25E5%2599%25A8%25E7%2594%259F%25E6%2588%2590%25E4%25BB%25A3%25E7%25A0%2581%25E7%25AC%25AC%25E4%25B8%2589%25E9%2583%25A8%25E5%2588%2586%25E7%2594%259F%25E6%2588%2590%25E6%25BA%2590%25E4%25BB%25A3%25E7%25A0%2581%2f"><i class="fab fa-2x fa-fw fa-facebook-f mb-2"></i> Facebook</a></div><hr class=mb-4><div class="actions d-flex overflow-auto align-items-center"><a role=button class="action action-go-back d-flex flex-column align-items-center me-3" href="javascript: window.history.back();"><span class="action-icon mb-2"><i class="fas fa-2x fa-chevron-circle-down" data-fa-transform=rotate-90></i></span> 返回</a>
<a role=button class="action action-reload-page d-flex flex-column align-items-center me-3"><span class="action-icon mb-2"><i class="fas fa-2x fa-redo-alt"></i></span> 刷新</a>
<a role=button class="action action-copy-url d-flex flex-column align-items-center me-3"><span class="action-icon mb-2"><i class="fas fa-2x fa-link"></i></span> 复制链接</a></div></div></div><ul class="nav justify-content-between footer-memu mb-3"><li class=nav-item><ul class="nav flex-column align-items-start"><li class=nav-item><a class="nav-link fw-bold fs-lg" href="javascript: void(0);">support</a></li><li class=nav-item><a class=nav-link href=/contact/><i class="fas fa-fw fa-info-circle"></i>联系我</a></li></ul></li></ul><nav class="social-links nav justify-content-center mb-2"><a class="nav-link social-link" target=_blank href=https://space.bilibili.com/438403014 title=bilibili rel="noopener noreferrer"><i class="fa-fw fa-2x fab fa-bilibili"></i></a>
<a class="nav-link social-link" href=mailto:qinxiandiqi@foxmail.com title=Email><i class="fas fa-fw fa-2x fa-envelope"></i></a>
<a class="nav-link social-link" target=_blank href=https://facebook.com/qinxiandiqi title=Facebook rel="noopener noreferrer"><i class="fa-fw fa-2x fab fa-facebook-f"></i></a>
<a class="nav-link social-link" target=_blank href=https://github.com/qinxiandiqi title=GitHub rel="noopener noreferrer"><i class="fa-fw fa-2x fab fa-github"></i></a>
<a class="nav-link social-link" target=_blank href="http://wpa.qq.com/msgrd?v=3&uin=493059154&site=qq&menu=yes" title=QQ rel="noopener noreferrer"><i class="fa-fw fa-2x fab fa-qq"></i></a>
<a class="nav-link social-link" target=_blank href=https://twitter.com/qinxiandiqi title=Twitter rel="noopener noreferrer"><i class="fa-fw fa-2x fab fa-twitter"></i></a>
<a class="nav-link social-link" target=_blank href=https://weibo.com/qinxiandiqi title=Weibo rel="noopener noreferrer"><i class="fa-fw fa-2x fab fa-weibo"></i></a>
<a class="nav-link social-link" target=_blank href=https://www.zhihu.com/people/qinxiandiqi title=Zhihu rel="noopener noreferrer"><i class="fa-fw fa-2x fab fa-zhihu"></i></a>
<a class="nav-link social-link" target=_blank href=https://www.qinxiandiqi.sbs/index.xml title=RSS rel="noopener noreferrer"><i class="fas fa-fw fa-2x fa-rss"></i></a></nav><div class="copyright mb-2">Copyright © 2012-2023 Jianan. All Rights Reserved.</div><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><div class="copyright mb-2"><span id=busuanzi_container_site_uv>👤Total Visitors <span id=busuanzi_value_site_uv></span> |</span>
<span id=busuanzi_container_site_pv>👁️Total Views <span id=busuanzi_value_site_pv></span></span></div><div class="powered-by mb-2">Powered by <a class=text-primary href=https://gohugo.io target=_blank rel="noopener noreferrer">Hugo</a> and the <a class=text-primary href=https://github.com/razonyang/hugo-theme-bootstrap target=_blank rel="noopener noreferrer">HBS</a> theme.</div></footer><script data-precache src=https://www.qinxiandiqi.sbs/assets/main/bundle.min.d5ec8fcfaf41870da39b8abc05b61ba8f67aa035b6a418ecd0f5fecc59b8f195.js integrity="sha256-1eyPz69Bhw2jm4q8BbYbqPZ6oDW2pBjs0PX+zFm48ZU=" crossorigin=anonymous defer></script><script data-precache src=https://www.qinxiandiqi.sbs/assets/icons/bundle.min.9b65a1892e3a9ee67ad669fdde6abd4963c890151073f181b3e730bce85680a6.js integrity="sha256-m2WhiS46nuZ61mn93mq9SWPIkBUQc/GBs+cwvOhWgKY=" crossorigin=anonymous defer></script>
<script data-precache src=https://www.qinxiandiqi.sbs/assets/viewer/bundle.min.9f713149f059d05fcb65e7f7c27308e61c384500e80ab1c333c2510a36a5d70c.js integrity="sha256-n3ExSfBZ0F/LZef3wnMI5hw4RQDoCrHDM8JRCjal1ww=" crossorigin=anonymous defer></script><script>"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("https://www.qinxiandiqi.sbs/service-worker.min.js").then(function(e){console.log("Successfully registered service worker",e)}).catch(function(e){console.warn("Error whilst registering service worker",e)})})</script></body></html>